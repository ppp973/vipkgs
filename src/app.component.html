
<div class="bg-dark-bg min-h-screen">
  <!-- Header -->
  <header class="sticky top-0 z-30 bg-dark-card/80 backdrop-blur-lg border-b border-gray-700/50">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="h-16 flex items-center justify-between">
              <!-- Left Side: Back Button or Menu -->
              <div class="flex items-center">
                  @if (showBackButton()) {
                      <button (click)="goBack()" class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-700/50 active:scale-95 transition-all duration-200">
                          <i class="fas fa-arrow-left text-gray-200"></i>
                      </button>
                  } @else {
                      <button class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-700/50 transition-colors">
                          <i class="fas fa-bars text-xl text-gray-200"></i>
                      </button>
                  }
              </div>

              <!-- Center: Title -->
              <div class="flex items-center">
                <h1 class="text-xl font-bold text-white tracking-wide">Winners Institute</h1>
              </div>

              <!-- Right Side: Spacer/Actions -->
              <div class="w-10"></div>
          </div>
      </div>
  </header>

  <!-- Scrollable Content -->
  <main class="animate-fade-in pb-24 md:pb-8">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <!-- Search Area -->
          @if (currentView().type === 'courses') {
            <div class="my-6">
                <div class="flex flex-col sm:flex-row gap-3">
                    <div class="flex-1 relative">
                        <input (input)="handleSearch($event)" [value]="searchTerm()" type="text" placeholder="Search Here....." class="w-full pl-12 pr-4 py-3 rounded-lg bg-dark-card border border-gray-700 focus:ring-2 focus:ring-brand-500 focus:border-brand-500 transition-all text-white placeholder-gray-500">
                        <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-500"></i>
                    </div>
                    <button class="px-8 py-3 bg-brand-600 text-white font-semibold rounded-lg hover:bg-brand-700 transition-colors shadow-lg shadow-brand-900/40">Search</button>
                </div>
            </div>
          } @else {
             <h2 class="text-2xl font-bold text-white my-6">{{ pageTitle() }}</h2>
          }

          @if(isLoading()) {
              @switch (currentView().type) {
                  @case ('courses') { <app-skeleton-loader type="grid" /> }
                  @case ('saved') { <app-skeleton-loader type="grid" /> }
                  @case ('subjects') { <app-skeleton-loader type="list" /> }
                  @case ('lessons') { <app-skeleton-loader type="player" /> }
              }
          } @else {
              @if (hasError()) {
                  <div class="flex flex-col items-center justify-center py-20 text-center">
                      <div class="w-24 h-24 rounded-full bg-dark-card flex items-center justify-center mb-4">
                          <i class="fas fa-exclamation-triangle text-4xl text-yellow-500"></i>
                      </div>
                      <p class="text-gray-300 font-semibold text-xl">Oops! Something went wrong.</p>
                      <p class="text-gray-400 text-base mt-2 max-w-md">We couldn't load the content right now. Please check your internet connection and try again.</p>
                  </div>
              } @else {
                  @switch (currentView().type) {
                      @case ('courses') {
                          <!-- Course Grid -->
                          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                              @for (course of filteredCourses(); track course.id) {
                                  <div (click)="selectCourse(course)" class="card-hover bg-dark-card rounded-lg overflow-hidden cursor-pointer flex flex-col">
                                      <div class="p-4 flex justify-between items-start">
                                          <h3 class="font-bold text-white leading-tight h-12 line-clamp-2 pr-4">{{ course.title }}</h3>
                                          <button (click)="toggleSave(course.id, $event)" class="w-8 h-8 flex-shrink-0 text-xl text-gray-400 hover:text-white transition-colors">
                                              <i class="fa-heart" [class.fas]="savedCourseIds().has(course.id)" [class.far]="!savedCourseIds().has(course.id)" [class.text-red-500]="savedCourseIds().has(course.id)"></i>
                                          </button>
                                      </div>
                                      <div class="aspect-[16/9] overflow-hidden">
                                          <img [src]="course.image || 'https://picsum.photos/400/225'" class="w-full h-full object-cover" alt="Course thumbnail">
                                      </div>
                                      <div class="p-4 mt-auto">
                                          <button class="w-full py-3 bg-brand-600 text-white font-semibold rounded-lg hover:bg-brand-700 transition-colors">LET'S STUDY</button>
                                      </div>
                                  </div>
                              } @empty {
                                  <p class="text-center text-gray-500 sm:col-span-2 lg:col-span-3 xl:col-span-4 py-16">No courses found.</p>
                              }
                          </div>
                      }
                      @case ('saved') {
                           <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                              @for (course of savedCourses(); track course.id) {
                                <div (click)="selectCourse(course)" class="card-hover bg-dark-card rounded-lg overflow-hidden cursor-pointer flex flex-col">
                                    <div class="p-4 flex justify-between items-start">
                                        <h3 class="font-bold text-white leading-tight h-12 line-clamp-2 pr-4">{{ course.title }}</h3>
                                        <button (click)="toggleSave(course.id, $event)" class="w-8 h-8 flex-shrink-0 text-xl text-red-500 transition-colors">
                                            <i class="fas fa-heart"></i>
                                        </button>
                                    </div>
                                    <div class="aspect-[16/9] overflow-hidden">
                                        <img [src]="course.image || 'https://picsum.photos/400/225'" class="w-full h-full object-cover" alt="Course thumbnail">
                                    </div>
                                    <div class="p-4 mt-auto">
                                        <button class="w-full py-3 bg-brand-600 text-white font-semibold rounded-lg hover:bg-brand-700 transition-colors">LET'S STUDY</button>
                                    </div>
                                </div>
                              } @empty {
                                  <div class="sm:col-span-2 lg:col-span-3 xl:col-span-4 flex flex-col items-center justify-center py-20 text-gray-500">
                                      <div class="w-24 h-24 rounded-full bg-dark-card flex items-center justify-center mb-4">
                                          <i class="far fa-heart text-3xl text-pink-400"></i>
                                      </div>
                                      <p class="font-medium">No saved courses yet.</p>
                                  </div>
                              }
                          </div>
                      }
                      @case ('subjects') {
                           <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
                              @for (subject of subjects(); track subject.id) {
                                  <div (click)="selectSubject(subject)" class="card-hover bg-dark-card p-4 rounded-lg flex items-center justify-between cursor-pointer">
                                      <div class="flex items-center gap-4">
                                          <div class="w-14 h-14 rounded-lg bg-brand-900/50 flex items-center justify-center text-brand-400 flex-shrink-0">
                                              <i class="fas fa-folder-open text-2xl"></i>
                                          </div>
                                          <div>
                                              <h4 class="font-bold text-white text-sm line-clamp-2">{{ subject.name }}</h4>
                                              @if(subject.videos) {
                                                <p class="text-xs text-gray-400 font-medium mt-1">{{ subject.videos }} Lectures</p>
                                              }
                                          </div>
                                      </div>
                                      <i class="fas fa-chevron-right text-gray-600 text-xs"></i>
                                  </div>
                              } @empty {
                                  <p class="text-center text-gray-500 md:col-span-2 lg:col-span-3 py-16">No subjects in this course.</p>
                              }
                          </div>
                      }
                      @case ('lessons') {
                         @if (currentLesson(); as lesson) {
                          <div class="lg:grid lg:grid-cols-3 lg:gap-8 xl:gap-12">
                              <div class="lg:col-span-2">
                                  <app-video-player [src]="lesson.video_url"></app-video-player>
                                  <div class="bg-dark-card rounded-lg p-5 mt-6">
                                      <h2 class="font-bold text-white text-xl leading-snug">{{ lesson.name }}</h2>
                                  </div>
                              </div>
                              <div class="lg:col-span-1 mt-6 lg:mt-0">
                                  <div class="bg-dark-card rounded-lg p-4 h-full">
                                    <h3 class="font-bold mb-4 text-lg px-2 text-white">Lectures</h3>
                                    <div class="flex flex-col gap-2 max-h-[70vh] overflow-y-auto pr-2">
                                      @for (item of lessons(); track item.id) {
                                          <button (click)="selectLesson(item)" class="block w-full text-left p-3 rounded-lg hover:bg-gray-700/50 transition-colors" [class.bg-brand-700/40]="item.id === lesson.id">
                                              <h4 class="font-semibold text-sm text-gray-200">{{ item.name }}</h4>
                                              <p class="text-xs text-gray-500 mt-1">Video</p>
                                          </button>
                                      }
                                    </div>
                                  </div>
                              </div>
                          </div>
                         } @else {
                          <p class="text-center text-gray-500 py-16">No lessons in this subject.</p>
                         }
                      }
                  }
              }
          }
      </div>
  </main>
</div>

<!-- Mobile Bottom Navigation -->
<nav class="md:hidden fixed bottom-0 left-0 right-0 z-50">
    <div class="bg-dark-card flex justify-around items-center h-16 border-t border-gray-700/50">
        <button (click)="goHome()" class="flex flex-col items-center justify-center w-1/2 h-full" [class.text-brand-400]="currentView().type !== 'saved'" [class.text-gray-400]="currentView().type === 'saved'">
            <i class="fas fa-home text-xl"></i>
            <span class="text-xs mt-1">Home</span>
        </button>
        <button (click)="showSaved()" class="flex flex-col items-center justify-center w-1/2 h-full" [class.text-brand-400]="currentView().type === 'saved'" [class.text-gray-400]="currentView().type !== 'saved'">
            <i class="fas fa-heart text-xl"></i>
            <span class="text-xs mt-1">Saved</span>
        </button>
    </div>
</nav>

<!-- Toast Notification -->
@if (toastMessage()) {
    <div class="fixed bottom-24 md:bottom-8 left-1/2 -translate-x-1/2 bg-gray-900/80 backdrop-blur text-white text-sm py-3 px-6 rounded-xl shadow-lg animate-slide-up z-50">
        {{ toastMessage() }}
    </div>
}
